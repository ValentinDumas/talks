---
# You can also start simply with 'default'
theme: seriph
titleTemplate: '%s - Valentin Dumas'
fonts:
  sans: DM Sans
  serif: Noto Serif
  mono: Consolas
addons:
  - slidev-addon-graph
background: https://images.unsplash.com/photo-1716406536069-c27068316336?q=80&w=2081&auto=format&fit=crop&ixlib=rb-4.1.0&ixid=M3wxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8fA%3D%3D
# some information about your slides (markdown enabled)
title: "Le dilemme du Code Legacy: on maintient ou on r√©√©crit ?"
info: |
  ## Slidev Starter Template
  Presentation slides for developers.
class: text-center
drawings:
  persist: false
transition: fade
mdc: true
---

# Le dilemme du code legacy

## Maintenir ou R√©√©crire ?

<div class="abs-br m-6 text-xl">
  <span class="text-xs m-x-3 text-white/60">Valentin Dumas</span>
  <a href="https://github.com/ValentinDumas/talks" target="_blank" class="slidev-icon-btn">
    <carbon:logo-github />
  </a>
  <a href="https://www.linkedin.com/in/valentindumas" target="_blank" class="slidev-icon-btn">
    <carbon:logo-linkedin />
  </a>
</div>

<!--
The last comment block of each slide will be treated as slide notes. It will be visible and editable in Presenter Mode along with the slide. [Read more in the docs](https://sli.dev/guide/syntax.html#notes)
-->

---
name: Ariane5 case study
layout: center
class: opacity-80
---

<div class="size-full flex items-center justify-center">
  <img src="/ariane5_501_launch_2k.jpg" alt="alien signals" class="h-120" />
</div>


<!-- 

En Guyane fran√ßaise, le 4 juin 1996. Le ciel est d√©gag√©, l'excitation est palpable : Ariane 5 s'appr√™te √† effectuer son vol inaugural.
Mais 37 secondes apr√®s le d√©collage, l'impensable se produit : la fus√©e d√©vie de sa trajectoire, se disloque et explose en plein vol.
√Ä l'origine de ce d√©sastre ? Une simple erreur logicielle: un probl√®me de saturation d'entier non g√©r√©e lors de la conversion d'une valeur de 64 bits en 16 bits.
Ensuite ? Ce d√©passement a entra√Æn√© l'arr√™t du syst√®me de guidage inertiel principal, puis de son syst√®me de secours identique. Priv√©e de toute information de navigation, la fus√©e a interpr√©t√© des donn√©es erron√©es comme des commandes valides, d√©clenchant une man≈ìuvre fatale. Wikipedia+5Wikipedia+5www-users.cse.umn.edu+5
En cause ? Un morceau de code h√©rit√© d'Ariane 4, cens√© √™tre inoffensif‚Ä¶
Bilan ? Un √©chec retentissant, une perte de centaines de millions de dollars, et quatre satellites scientifiques d√©truits. thisdayinaviation.com+7Sunny Day+7SmartBear Software+7SmartBear Software+7Wikipedia+7Wikipedia+7
Ce qui aurait pu √™tre √©vit√© ?

-->

---
name: Ariane5 case study possible improvements
transition: slide-left
layout: image-right
image: /ariane5_501_launch_2k.jpg
class: opacity-80
---

# Un bug co√ªteux

Ce qui aurait pu fonctionner ?

<div class="text-xl opacity-80 p-2">

  <span v-click>üìù Tests complets du SRI</span>
  <br><br>

  <span v-click>üßë‚Äçüíª <i>" √ßa fonctionne sur l'ancien "</i></span>
  <br><br>

  <span v-click>ü§π Version 4 != Version 5</span>
  <br><br>

  <span v-click>üõ† Gestion d'exceptions, programmation d√©fensive</span>
  <!-- note: peut sugg√©rer un manque de tests -->
  <!-- note: sur des donn√©es sensibles comme √ßa, on peut emettre des r√©serves sur les requetes de r√©cup√©ration -->

</div>

<style>
strong, h1 {
  color: #2B90B6;
}
</style>

<!--
C‚Äôest un exemple visc√©ral qui d√©montre pourquoi les syst√®mes legacy n√©cessitent une attention strat√©gique,
car parfois,
une simple ligne de code peut faire la diff√©rence entre le succ√®s et la catastrophe.
-->

---
transition: slide-up
layout: statement
class: text-4xl opacity-80
---

‚ùù Legacy code is simply code **without tests** ‚ùû

<span class="text-base text-gray-500">‚Äî Michael Feathers</span>

<!-- ... -->

<style>
strong {
  color: #2B90B6;
}
</style>

---
transition: slide-up
layout: statement
class: text-4xl opacity-80
---

‚ùù Legacy code is **valuable** code
<br>
<br>

you're **afraid** to change ‚ùû

<span class="text-base text-gray-500">‚Äî Nicolas Carlo & Alex Bolboaca</span>

<!-- ... -->

<style>
strong {
  color: #2B90B6;
}
</style>

---
name: Pr√©sentation
layout: statement
class: opacity-80
---

<div class="flex flex-col justify-center items-center gap-3">
  <img src="/profile.jpg" alt="profile picture" class="h-50 rounded-100"/>
  <div class="pl-4 text-xl"><strong>Valentin DUMAS</strong></div>
  <div class="pl-4 text-sm">Ing√©nieur logiciel</div>
  <img src="/logo-takima.png" alt="Logo Takima" class="h-10 pl-4 pt-2" />
</div>

---
transition: slide-left
layout: default
---

<!-- TODO: probablement remplacer par un exemple de ton exercice de use case -->
```java [Extrait du Gilded Rose refactoring Kata] {*}{lines:true, maxHeight:'63vh'}
public void updateQuality() {
        for (int i = 0; i < items.length; i++) {
            if (!items[i].name.equals("Aged Brie")
                    && !items[i].name.equals("Backstage passes to a TAFKAL80ETC concert")) {
                if (items[i].quality > 0) {
                    if (!items[i].name.equals("Sulfuras, Hand of Ragnaros")) {
                        items[i].quality = items[i].quality - 1;
                    }
                }
            } else {
                if (items[i].quality < 50) {
                    items[i].quality = items[i].quality + 1;

                    if (items[i].name.equals("Backstage passes to a TAFKAL80ETC concert")) {
                        if (items[i].sellIn < 11) {
                            if (items[i].quality < 50) {
                                items[i].quality = items[i].quality + 1;
                            }
                        }

                        if (items[i].sellIn < 6) {
                            if (items[i].quality < 50) {
                                items[i].quality = items[i].quality + 1;
                            }
                        }
                    }
                }
            }

            if (!items[i].name.equals("Sulfuras, Hand of Ragnaros")) {
                items[i].sellIn = items[i].sellIn - 1;
            }

            if (items[i].sellIn < 0) {
                if (!items[i].name.equals("Aged Brie")) {
                    if (!items[i].name.equals("Backstage passes to a TAFKAL80ETC concert")) {
                        if (items[i].quality > 0) {
                            if (!items[i].name.equals("Sulfuras, Hand of Ragnaros")) {
                                items[i].quality = items[i].quality - 1;
                            }
                        }
                    } else {
                        items[i].quality = items[i].quality - items[i].quality;
                    }
                } else {
                    if (items[i].quality < 50) {
                        items[i].quality = items[i].quality + 1;
                    }
                }
            }
        }
    }
```

<!--
  Imagine un matin, tu arrives au bureau et quand tu ouvres ton IDE la premi√®re chose que tu vois c‚Äôest √ßa:

  **Montrer code** Vous arrivez √† lire ce code ?.. Vous √™tes forts.
  ** Expliquer code rapidement, ses d√©fauts, ce qui peut √™tre am√©lior√©**
  ** montrer le code simplifi√©**

  Plusieurs challenges, dont un code domaine/m√©tier qui peut s‚Äôav√©rer:
  complexe
  peu lisible

  On peut aussi parler de code enchev√™tr√©, spaghetti, BBofMud, ‚Ä¶

  **Montrer le plat de p√¢tes**
  Quand vous codez un soft, vous voyez le plat de p√¢tes.
  Vos relecteurs, et m√™me vous-m√™me apr√®s quelques mois sans relire le code = ce que vous voyez est magique.
  complexit√© visuelle ‚Üí peu lisible

  A cette complexit√© s‚Äôajoute ceci.
-->

---
name: Enjeux et Challenges du code legacy
transition: slide-left
layout: two-cols
---

# Un peu de legacy
Enjeux et challenges

<div class="flex flex-col gap-6 p-10 justify-center">
  <!-- Ligne 1 -->
  <div class="flex gap-8 items-center">
    <img v-click="1" src="/icons/project-with-deadlines.png" alt="Planning" class="h-24" />
    <img v-click="2" src="/icons/person-with-idea.png" alt="Dev" class="h-20" />
    <img v-click="3" src="/icons/debt.png" alt="Debt" class="h-20" />
  </div>
  <!-- Ligne 2 -->
  <div v-click="4" class="flex gap-8 items-center">
    <img src="/icons/code.png" alt="Code" class="h-20" />
    <span v-mark="4" class="text-xl">&gt; 100k lignes</span>
  </div>
  <!-- Ligne 3 -->
  <div v-click="5" class="flex gap-8 items-center">
    <img src="/icons/database.png" alt="Database" class="h-20" />
    <img src="/icons/cloud.png" alt="Cloud" class="h-20" />
  </div>
</div>

::right::

<div v-click="6" class="w-full h-full flex justify-center items-center">
<img src="/dependency-issues.jpg" class="h-100" alt="Dependency issues" />
</div>

---
name: Enjeux et Challenges du code legacy pt. 2
transition: slide-left
layout: two-cols
class: opacity-80
---

# Un peu de legacy
Enjeux et challenges

<div class="flex flex-col gap-6 justify-center">
  <img src="/icons/kapla-tower-beautiful.png" class="h-100" alt="Dependency issues" />
</div>

::right::

<div class="w-full h-full flex flex-col justify-center items-center py-25">
  <!-- Ligne 1 -->
  <div class="flex gap-8 items-center">
    <img v-click src="/icons/kapla-tower-instable.png" alt="Kaplar Tower Instable" class="w-60" />
    <img v-click src="/icons/mikado.png" alt="Mikado" class="w-45" />
  </div>
  <!-- Ligne 2 -->
  <div v-click class="flex gap-8 items-center">
    <img src="/icons/bonhomme-tire-pelote.png" alt="Code" />
  </div>
</div>

<!-- notes
  Question: comment on en est arriv√©s l√† ?
 -->


---
transition: slide-up
layout: statement
class: text-4xl
---

‚ùù Tout code **deviendra legacy** ‚ùû

<style>
strong {
  color: #2B90B6;
}
</style>

<!--

‚ÄúAvoir un code Legacy n'est pas un √©chec, √ßa prouve que l'application a eu du succ√®s dans le temps, malgr√© la dette technique. De toute fa√ßon n'importe quel code, aussi beau soit-il √©crit aujourd'hui sera le Legacy de demain. Il est quand m√™me important de revenir r√©guli√®rement pour rafra√Æchir le code et enlever progressivement de la dette technique.‚Äù explique Gabriel Pillet, CTO chez Web^ID.

Effectivement, il y a 3 types de code legacy :
- Le code qui a √©t√© soign√© par ses pr√©d√©cesseurs. Il est clair, comment√©, test√© et donc facilement maintenable (mais cela n‚Äôest pas le cas le plus fr√©quent !).
- Le code difficilement maintenable. Il n‚Äôest pas tr√®s lisible au premier coup d‚Äô≈ìil, il contient du code mort ou dupliqu√©, il y a des classes trop grandes, il y a peu, voire pas de tests unitaires, etc.
- Le code obsol√®te. C‚Äôest un code qui n‚Äôa pas suivi les √©volutions de framework et/ou de langage. Avec les changements de versions, il est devenu difficile d‚Äôajouter une feature et les d√©veloppeurs passent leur temps √† maintenir le code √† flot.

-->

---
name: Sympt√¥mes d'un code legacy
transition: slide-left
layout: two-cols
class: h-10 opacity-80
---

# Sympt√¥mes d‚Äôun code legacy

> Comprendre les sources des probl√®mes

<!-- 

√âvolution du mod√®le (√©conomique, processus, r√®gles)
  ex: Changements r√©glementaires
>> users que pr√©vu, donc ‚ÄúMon app ne tient pas la charge‚Äù
Perte de ma√Ætrise (connaissance / 1 personne, 0 tests, ..)
Maintenance co√ªteuse (dette)

 
-->

<div v-click="1" class="flex flex-col justify-center h-full pt-42">
  <h3 class="text-xl font-bold mb-4">üîß Facteurs internes</h3>
  <ul v-click="2"class="list-disc list-inside space-y-2 text-left">
    <li>V√©locit√© basse <!-- ou ne fait que baisser / + de temps pour amener des new features --></li>
    <li>Bugs et regressions <!-- (fonctionnelles) --></li>
    <li>Connaissance / 1 personne <!-- (!! si ils partent compliqu√© entreprise de subsister) --></li>
    <li>Couplage fort entre modules</li>
    <li>Absence ou faible couverture de tests</li>
    <li>Manque de documentation</li>
  </ul>
</div>

::right::

<div v-click=3 class="flex flex-col pt-40">
  <h3 class="text-xl font-bold mb-4">üß≠ Facteurs externes</h3>
  <ul v-click="4" class="list-disc list-inside space-y-2 text-left">
    <li>√âvolution du mod√®le </li>
    <li>Changements r√©glementaires</li>
    <li>Turn-over</li>
    <li class="opacity-50">>> users que pr√©vu</li>
    <li class="opacity-50">Pression business pour livrer vite</li>
    <li class="opacity-50">Empilement de demandes clients</li>
    </ul>
</div>

<!-- Code legacy = co√ªts + risques -->

---
transition: slide-left
layout: default
class: text-2xl opacity-80
---

# Probl√®mes pour les devs

<div class="text-xl p-2">

  üò§ Rechignement <!-- (olala √ßa touche √† la partie de codebase que j‚Äôaime pas). -->
  <br><br>

  ‚ö° Tensions <!-- = shipper √† la boure (incompr√©hensions entre les √©quipes produits et dev. -->
  <br><br>

  üòû R√©signation <!-- de tte facon tout le monde s‚Äôen fout, la codebase est pourrie, donc je continue √† shipper du code pourri. et si √ßa me saoule un jour je m‚Äôen vais. -->
  <br><br>

</div>

---
transition: slide-left
layout: default
class: text-2xl opacity-80
---

# Probl√®mes pour les entreprises

<div class="text-xl p-2">

  üèÉ‚Äç‚ôÇÔ∏è Perte de comp√©titivit√©  
  <br><br>
  üöå ‚ÄúBus factor‚Äù
  <br><br>

</div>

<!--
  Perte comp√©titivit√©: Code legacy != que un pb pour les dev, c(‚Äòest un pb  pour l‚Äôentreprise !! (ex: si les concurrents sont plus stables, ‚Ä¶)

  "Bus Factor": le guru s(en va de l‚Äôentreprise (risque strat√©gique) = plus personne peut maintenir le code existant. Comment faire ???
-->

---
name: Remediation possibles
transition: slide-left
class: opacity-80
---

# üö® Situations fr√©quentes vs üí° Solutions

<div class="pt-10">
<table class="w-full text-sm border-collapse">
  <thead>
    <tr class="border-b">
      <th class="text-left p-2">üß© <strong>Situation</strong></th>
      <th class="text-left p-2">üõ†Ô∏è <strong>Solution</strong></th>
    </tr>
  </thead>
  <tbody>
    <tr v-click="1" class="border-b align-top">
      <td class="p-2">
        <strong>Pas le temps / pas le budget</strong><br>
        <span class="text-gray-500 italic">Perte de ma√Ætrise: risques vs co√ªts<br>Incompr√©hension du code</span>
      </td>
      <td class="p-2">
        üëâ Pr√©senter les <strong>risques concrets</strong> et les <strong>co√ªts potentiels</strong>
      </td>
    </tr>
    <tr v-click="2" class="border-b align-top">
      <td class="p-2">
        <strong>Refonte en sous-marin</strong><br>
        <span class="text-gray-500 italic">Estimation fauss√©e volontairement<br>Confiance rompue entre devs et produit.</span>
      </td>
      <td class="p-2">
        ü§ù Recr√©er la <strong>confiance</strong> entre les √©quipes.
      </td>
    </tr>
    <tr v-click="3" class="align-top">
      <td class="p-2">
        <strong>Refonte sans fin</strong><br>
        <span class="text-gray-500 italic">Deux codebases √† maintenir. La nouvelle devient aussi legacy.<br>Aucun plan clair.</span>
      </td>
      <td class="p-2">
        üß≠ Besoin de <strong>planification</strong> claire<br>
        üìö <strong>Former</strong> au refacto
      </td>
    </tr>
  </tbody>
</table>
</div>

<!--
  Pas le temps / budget:
    - Souvent li√© √† une peur de toucher une zone mal comprise du code.
    - La personne n‚Äôa pas la ma√Ætrise des risques / co√ªts r√©els
  Refonte sous-marin
    -pb de confiance (ex de surestimation de ticket)
    - üß© *TODO: Activit√©s d‚Äôalignement, ateliers √† d√©finir* |
  Refonte sans fin
    - ex: daily.
-->

---
name: Etude de cas banque en ligne qui veut s'etendre √† linternational
transition: slide-left
class: opacity-80
---

# Etude de cas

<div class="pt-20 flex flex-col justify-center w-150">
  <Card>
  
  <span v-click>üåé Banque en ligne fran√ßaise qui veut s'ouvrir √† l'international</span>
  <br>

  <span v-click>üëõ Besoin: gestion multidevises</span>
  <br>

  <span v-click>üîß Code <!-- devenu --> complexe et fragile</span>
  <br>
  
  <span v-click>üí• Compr√©hension difficile</span> <!-- Equipes ont peur de "casser" le "code" ! -->

  </Card>
</div>

<!-- Comment faire ? -->

---
transition: slide-left
layout: two-cols
class: opacity-80
---

# **Mesurer** les risques et les co√ªts

<!-- TODO: Lire pour la def de la dette; https://www.bitegarden.com/how-to-evaluate-technical-debt-sonarqube -->

<div class="space-y-4">
  <div v-click="1">üßº <strong>Qualit√©</strong> de code <span class="opacity-60 text-sm"> (dette, code smells, WTF par minute)</span></div>
  <div v-click="3">üêõ Nombre de <strong>r√©gressions</strong> fonctionnelles</div>
  <div v-click="4">‚è±Ô∏è Temps <strong>estim√©</strong> vs Temps <strong>r√©el</strong></div>
  <div v-click="5">üí∏ <strong>Co√ªt r√©el</strong> par feature</div>
</div>

<!-- 
  Qualit√© de code: Sonar, ... Par o√π commencer ?
  Nombre de r√©gressions fonctionnelles: 
  Compter le temps r√©el pass√© √† faire des correctifs
    => cout r√©el: "comparer annonc√© au po VS pris en vrai pour shipper la feature + corriger pb amen√©s"
-->

::right::

<div v-click="2" class="flex flex-col justify-center items-center w-full h-full pl-12">
  <img src="/sonarqube-tech-debt.png" />
</div>

<!-- 
Comparer ‚Äúannonc√© au PO‚Äù VS ‚Äútemps r√©el pris pour shipper la feature + corriger les pb/bugs que √ßa a amen√©.‚Äù
Une fois qu‚Äôon a fait √ßa, on peut r√©fl√©chir √† un plan

Note: y'a pas de recette magique qui fonctionne √† 100% √† chaque fois ! car on fait beaucoup d'humain, et l'humain est faillible: nous avons nos qualit√©s / d√©faut -> et c'est √ßa qui rend notre m√©tier passionnant !  
-->

---
transition: slide-left
class: opacity-80
---

# **Proposer** un plan

<h3 v-click>üéØ P√©rim√®tre d'intervention</h3>
<br>
<div class="space-y- pl-4">
  <div v-click>üó∫Ô∏è D√©finir un p√©rim√®tre d'<strong>intervention initial</strong></div>
</div>

<br>
  
  <!--
  l√† ou √ßa a le plus d'impact ? 
  (on ne refacto pas toute une codebase comme √ßa d‚Äôun coup., mais partie par partie, progressivement. (Exemple: On focus sur la ‚Äúprise de commande)
  -->

<h3 v-click>üéØ Actions</h3>
<br>
<div class="space-y- pl-4 flex flex-col gap-4">
  <div v-click>üõ°Ô∏è Pratiques de d√©veloppement</div>
  <div v-click>üîç Expliciter les concepts m√©tier</div>
  <span v-click class="text-sm text-gray-500 pl-8">Ex : une colonne "montant" ‚Üí en fait un montant en euros : migration, renommage, typage</span>
  <div v-click>üö´ Eviter le "code freeze" !</div> <!-- on continue d'int√©grer ! -->
  <span v-click class="text-sm text-gray-500 pl-8">Ne pas isoler la refonte sur une branche morte.  
  Indicateur : mesure de la part de "nouveau" code r√©ellement ex√©cut√©</span>
</div>

<!-- TODO: put items correctly
### Actions
- Pr√©venir les anomalies /bugs: utiliser des Value Objects (DDD). PK ?!
- Explicitation (devises/???utiliser exemple) == migration de BDD. (ex: ce montant est un montant en euros)
- Pas de code freeze !: pas partir sur une branche √† part et partir du principe que tout s‚Äôarr√™te √† c√¥t√©. Comment ? Indicateur: mesurer la proportion entre le vieux code et le nouveau code qui s‚Äôexecute.

**COMPARER le co√ªt: refonte VS statut quo**

Tout √ßa ? => Calculer le cop^put de la refonte (estimation gros grain √† ce stade)(en nombre de jour √† investir
	Comparer co√ªt refonte VS statut quo(=si on change rien)

Une fois qu‚Äôon a ces deux co√ªts ? 

A quoi nous revient la refonte (commencer √† estimer le nb de jours √† investir vs si on change rien)
 -->

---
transition: slide-left
class: opacity-80
---

# ü§ù **Communiquer** avec les parties prenantes

> Se synchroniser et avancer collectivement

<br>

<div class="space-y-4">
  <div v-click>üì£ Informer</div>
  <!-- <span class="text-sm text-gray-500 italic">
  Les personnes impact√©es par notre refonte des co√ªts et risques actuels (ex: √©quipe produit, devises)
  </span> -->
  <div v-click>üó∫Ô∏è Pr√©senter le plan de <strong>refonte</strong></div>
  <!-- <span class="text-sm text-gray-500 italic">
  Montrer en quoi la refonte r√©pond aux probl√®mes identifi√©s
  </span> -->
  <div v-click>ü§ù <strong>N√©gocier</strong> la planification</div>
  <!-- <span class="text-sm text-gray-500 italic">
  Avec le PO ou les sponsors : diplomatie et intelligence collective
  </span> -->
  <div v-click>‚úÖ Obtenir l‚Äô<strong>accord</strong> de la direction</div>
  <!-- <span class="text-sm text-gray-500 italic">
  Discussion avec les d√©cideurs (CTO, VP Engineering‚Ä¶)
  </span> -->
  <div v-click>üéØ Aligner avec la <strong>strat√©gie d‚Äôentreprise</strong></div>
  <!-- <span class="text-sm text-gray-500 italic">
  Montrer l'alignement entre la refonte et les objectifs globaux
  </span> -->
</div>

<!--
  parties prenantes <=> coll√®gues
  notes...
-->

---
transition: slide-left
class: opacity-80
--- 

# üëÅÔ∏è‚Äçüó®Ô∏è **Suivre** et donner de la **visibilit√©**

  <br>

  <span v-click>üöß √âviter l‚Äô**effet tunnel**</span> <!-- <span class="text-sm text-gray-500">Comment ? PoC, baby steps (Mikado), d√©ploiements r√©guliers</span> -->
  <br>

  <span v-click>‚è™ Tout changement est rollback-able rapidement</span> <!-- == s√©curit√© -->
  <br>

  <span v-click> üì¢ **Partager l'avancement** ‚Üí feedback</span> <!-- Permet de n√©gocier : qualit√©, ajustements, arbitrages justifi√©s -->
  <br>

<!-- 
Une fois qu‚Äôon rentre dans la phase de refonte, il faut faire un suivi, et rassurer les gens avec qui on va travailler.
!! risque que √ßa p√®te est gros,
!! commencer par tacler les projets les + ambitieux en 1er 
	!! sur les tous petits p√©rim√®tres‚Ä¶ pour voir si l‚Äôapproche fonctionne ou pas (P√∂C

√©viter l‚Äôeffet tunnel: ‚Ä¶POC, baby steps + d√©ploiements r√©guliers (√ßa spasse pas bien, on connait la cause !,

V√©rifier qu‚Äôon peut annuler un changement (=rollback) < 1 min (tr√®s rapidement, TODO: v√©rifier le time !)
Mettre en place des indicateurs qui ne peuvent pas r√©gresser: CI, warnings, ‚Ä¶
Le but de tout √ß√† ?
Partager l‚Äôavancement avec les personnes int√©ress√©es
ET n√©gocier des ajustements si n√©cessaire (ex: coordination des diffferentes taches avec les equipes produits (TODO: prendre un exemple)
!! Etre transparent syr les risques (tenir au courant les personnes impact√©es) !! 

-->

---
transition: slide-left
layout: center
class: opacity-80
---

<Card>
<!-- {theme: 'neutral', scale: 0.5} -->
```mermaid {scale: 1.0}
graph TD
A[Mesurer les risques / co√ªts] --> B
B[Proposer un plan] --> C
C[Communiquer] --> D
D[Suivre & Rassurer]
```
</Card>

<!-- TODO: peut√™tre surligner par √©tape pour la lisibilit√© !! (solution: ressortir ce diagramme √† chaque √©tape) -->

---
transition: slide-up
layout: statement
class: text-4xl
---

‚ùù Legacy code is about the **cost of change** ‚ùû

<span class="text-base text-gray-500">‚Äî Michael Feathers</span>

<!-- ... -->

<style>
strong {
  color: #2B90B6;
}
</style>

---
name: R√©√©criture ou travailler avec lexistant (Brownfield)
transition: slide-left
layout: image
image: https://images.unsplash.com/photo-1748701821466-0b9f8bf839ac?q=80&w=2051&auto=format&fit=crop&ixlib=rb-4.1.0&ixid=M3wxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8fA%3D%3D
class: text-xl flex flex-col justify-center opacity-80
---

# Un peu de r√©√©criture

<Card class="w-134 mt-10">

### **Brownfield** development

üêå Reprise de l‚Äôexistant
<br><br>
üí∏ Surprises dans le legacy
<br><br>
üîê Stack de l‚Äôexistant
<br><br>
üî• Risques d‚Äôendettement ++ (bugs, dette, deps.)
<br><br>
üß©Challenge: Int√©grer des nouvelles features
</Card>

<style>
h3 {
  color: #2B90B6;
}
</style>

<!-- notes.. -->

---
name: R√©√©criture from scratch (Greenfield)
transition: slide-left
layout: image
image: https://images.unsplash.com/photo-1506260408121-e353d10b87c7?q=80&w=2128&auto=format&fit=crop&ixlib=rb-4.1.0&ixid=M3wxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8fA%3D%3D
class: text-xl flex flex-col justify-center opacity-80
---

# Un peu de r√©√©criture

<Card class="w-134 mt-10">

### **Greenfield** development


‚è≥D√©lai initial plus court
<br><br>
üí∞ Budget pr√©visible
<br><br>
üß± Stack technique / architecture: choix libre
<br><br>
üü¢ Peu de risques / complexit√© (0 dette)
<br><br>
üß© N√©cessite d√©cisions: UI, backend, infra, tests‚Ä¶
</Card>

<style>
h3 {
  color: #2B90B6;
}
</style>

<!-- notes.. -->

---
transition: slide-left
layout: image
image: brownfield.png
---

# Prendre une d√©cision

<Card>

  <div v-click>
    <h4>üöÄ R√©√©crire</h4>
    <i class="opacity-60">
      <div>‚Äú Le code existant est un handicap (risques et co√ªts) ‚Äù</div> <!-- maintenance -->
      <div>‚Äú Vous disposez du temps, du budget et de la tol√©rance au risque n√©cessaires pour le reconstruire ‚Äù</div>
    </i>
    <br>
  </div>

  <div v-click>
    <h4>üèóÔ∏è Rearchitect</h4>
    <i class="opacity-60">
      <div>‚Äú L'architecture de votre syst√®me limite la croissance ‚Äù</div>
      <div>‚Äú Vous avez un couplage mod√©r√© √† fort entre vos composants projets ‚Äù</div>
    </i>
    <br>
  </div>

  <div v-click>
    <h4>üîß Refactor</h4>
    <i class="opacity-60">
      <div>‚Äú Vous pouvez nettoyer le code de mani√®re incr√©mentale,</div>
      <div>sans trop impacter les fonctionnalit√©s existantes ‚Äù</div>
   </i>
    <br>
  </div>
</Card>

<!-- notes.. -->

---
transition: slide-up
layout: statement
class: text-4xl
---

‚ùù On choisit de s'orienter vers

un **refactoring progressif** ‚ùû

<style>
strong {
  color: #2B90B6;
}
</style>

<!-- ... -->

---
transition: slide-left
layout: center
---

# R√©architecturer

Strangling the monolith

<img src="/strangling-the-monolith.png" class="w-95" />

<!--
  Rearchitecturer = Modifier la structure du code (parfois en changeant le comportement de l'application)
 -->

---
transition: slide-left
layout: center
---

# R√©architecturer

Branch-by-abstraction

<img src="/branch-by-abstraction.png" class="h-60" />

<!-- notes.. -->

---
transition: slide-left
---

<!-- Slide noire de transition -->

---
name: Notre exemple de refacto le Trivia
transition: slide-left
layout: image-right
image: /trivia-game.jpg
class: opacity-80
---

# Notre exemple
Jeu du Trivia

  <span v-click>üöÄ Jeu de questions r√©ponses</span>
  <br>

  <span v-click>üîß Code <!-- devenu --> complexe et fragile</span>
  <br>
  
  <span v-click>üí• Compr√©hension difficile</span> <!-- Equipes ont peur de "casser" le "code" ! -->
  <br><br>

<!-- Comment faire ? -->

<style>
strong {
  color: #2B90B6;
}
</style>

---
name: Refactorer code legacy focus on business value
transition: slide-left
layout: image
image: https://images.unsplash.com/photo-1634207284450-f6ad4451b94f?q=80&w=880&auto=format&fit=crop&ixlib=rb-4.1.0&ixid=M3wxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8fA%3D%3D
# class: text-xl flex flex-col justify-center
class: opacity-80
---

# Refactorer dans du code legacy

Recette √©tape par √©tape

<Card class="card w-134 mt-10 text-xl">

üî¶ Identifier les hotspots <!-- seams: fakeDB, seam object, 3rd party server, -->
<br><br>
üî® Casser les d√©pendances
<br><br>
üß™ Ecrire les tests <!-- n√©cessaires (UT, definition: <100ms and 1 feature) -->
<br><br>
üîß Effectuer un changement
<br><br>
üß© Refactorer <!-- si besoin -->
</Card>

<style>
h3 {
  color: #2B90B6;
}
p {
  color: #012;
}

.card p {
  color: unset;
}
</style>

<!-- notes.. -->

---
name: Refactoring example Identifier les hotspots
transition: slide-left
class: opacity-80
---

# Identifier les hotspots

> Quand ? vous ne savez pas par o√π commencer, votre temps est limit√©

<!-- Besoin: Pas un truc parfait, mais d'un Indicateur qui vous => prendre des d√©cisions plut√¥t que faire des hypoth√®ses (CodeClimate) -->

<br>
<h3><i>Comment ?</i></h3>
<br>
  1. Calculer la Complexit√© du Code (fichiers SonarQube) <!-- TODO: regarder  --> <!-- code-complexity (node), base sur num LoC -->
  <br><br>
  2. Calculez le Churn <!-- frequence de modification -->

  ```ts {*}
    git log --format=format: --name-only --since=12.month \
    | egrep -v '^$' \
    | egrep -v '\\.json$' \
    | sort \
    | uniq -c \
    | sort -nr \
    | head -50
  ```

  <!-- n√©cessaires (UT, definition: <100ms and 1 feature) -->

  <br>
  3. Meilleur ROI = Complexit√© <span class="opacity-60 text-xs">(Important)</span> * Churn <span class="opacity-60 text-xs">(Urgent)</span>
  <span class="opacity-60 text-xs pl-4">Augmente votre v√©locit√©</span>
  <br>

<!-- 
1.
2.
  git log: r√©cup√®re des logs
  egrep: retire toutes les lignes vides
  sort: tri alpha
  uniq -c: compte les occurences de chaque nom de fichier
  sort -nr: trie r√©sultats, d√©croissant
  head -50: garde 50 noms de fichiers les plus chang√©s
3.
 -->

---
name: Refactorer code legacy | Focus on business value
transition: slide-left
#layout: image
#image: https://images.unsplash.com/photo-1576153192396-180ecef2a715?q=80&w=1074&auto=format&fit=crop&ixlib=rb-4.1.0&ixid=M3wxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8fA%3D%3D
class: opacity-80
---

# Refactorer dans du code legacy

Focus sur la **valeur** m√©tier

<Card class="flex flex-row w-160">
  <img src="/refactoring-most-valued-features.png" />
</Card>

<!-- notes.. -->

---
name: Refactoring example Identifier les hotspots
transition: slide-left
class: opacity-80
---

# Identifier les hotspots

> Quand ? v√©rifier les impacts d'un changement

  <br>
  <h3>Diagramme de d√©pendance</h3>
  
  <img src="/dependency-diagram-petclinic.png" alt="dependency diagram petclinic" />

<!-- 
  ...
 -->
 
  <!-- Mikado = graphe de d√©pendance; lib√®re charge mentale; partage avec pairs -->
  <!-- compl√©ter objectifs par les bords du graph == safe ! => livrer en plusieurs fois -->

---
name: Refactoring example Identifier les hotspots
transition: slide-left
class: opacity-80
---

# Identifier les hotspots

> Quand ? v√©rifier les impacts d'un changement

  <br>
  <h3>Matrice de d√©pendance</h3>
  
  <img src="/dependency-matrix-petclinic.png" alt="dependency matrix petclinic" />

---
name: Refactorer code legacy | Scratch Refactoring et Exploratoire
transition: slide-left
#layout: image
#image: https://images.unsplash.com/photo-1576153192396-180ecef2a715?q=80&w=1074&auto=format&fit=crop&ixlib=rb-4.1.0&ixid=M3wxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8fA%3D%3D
---

# D√©couvrir du code legacy

Scratch Refactoring + Refactoring Exploratoire

> Quand ? Vous essayez de comprendre ce que le code fait vraiment

<br>

> Pratique >> Analyse th√©orique

<br>

<Card class="flex flex-row w-160">
  <img src="/scratch-refacto-timer.png" />
</Card>

<br>

> Permet ? Big Picture

<!--
Refacto Exploratoire

> quand ? avant les refactos structurels (Extract Function)
"Ce qui change en meme temps devrait √™tre gard√© √† proximit√©"
!! risqu√© si pas de tests.
-->

<!--
  Conseils d'uilisation de refacto (auto)
  + attention aux break;continue;return;
  +
    1. Extraire toutes les magic strings et les magic numbers
    2. Extraire des bouts de code dans des fonctions
    3. Inline ces fonctions √† nouveau
 -->

---
name: Scratch refacto | Ce qu'on a appris.
transition: slide-left
layout: image-right
image: /trivia-game.jpg
---

# Scratch Refactoring

Ce qu'on a appris

- Deux points d'entr√©e 'public': add() et roll()

- add(): initialize player data + affichage

- roll(): determine si le joueur est pi√©g√© ou non ET le d√©place


---
transition: slide-left
layout: statement
class: text-4xl opacity-80
---

# Tester

<style>
h1, h2 {
  color: #2B90B6;
}
</style>

---
name: Refactorer code legacy | Approval tests
transition: slide-left
---

# Approval Tests <!-- Golden, Characterization, Snapshot(React) -->

> Quand ? Mon code n'a aucun tests, je ne sais pas ce qu'il fait.

E2E >= Approval Tests >= Unit Test

https://approvaltests.com/

<div class="flex items-center justify-center gap-20">

  <img v-click="1" src="/approval-tests-boite-noire.png" class="h-20" />

  <!-- Left: Received -->
  <div v-click="2" class="flex flex-col items-center">
    <div class="text-7xl">üìÑ</div>
    <div class="mt-2 text-xl font-medium text-gray-400">File Received</div>
  </div>

  <!-- Arrow -->
  <div v-click="3" class="text-5xl text-gray-400">‚û°Ô∏è</div>

  <!-- Right: Approved -->
  <div v-click="4" v-mark="4" class="flex flex-col items-center">
    <div class="text-7xl">üìÑ</div>
    <div class="mt-2 text-xl font-medium text-green-700">File Approved</div>
  </div>

</div>

<!--
  [D√©mo] G√©n√©rer tests chara (cr√©er un test 'add player')
  [D√©mo][add()] simuler un changement (commenter un console.log)
  V√©rifier la nouvelle couverture de test:
    - IntelliJ/Sonar
    - PiTest (mutation testing), [opt] v√©rifier le N fois execution au niveau de la ligne ;)
  [D√©mo][add()] Commenter player.push() -> tests vont fail (boucle infinie)
  corriger
  commenter ligne d'en dessous -> fail
  [D√©mo] G√©n√©rer test 'add player roll' (avec un roll √† 777)

  [D√©mo][add()][opt] Ajouter un param/m√©thode/log pour 'tracker' les √©tats des variables priv√©es (ex: places)

-->

---
transition: slide-up
layout: statement
class: text-4xl opacity-80
---

‚ùù Je dois **tester** avant de refacto,
<br>
<br>

mais mon code est **intestable** ‚ùû

<style>
strong {
  color: #2B90B6;
}
</style>

<!-- ... -->

---
name: Refactorer code legacy | Decoupler Core vs Infra
transition: slide-left
layout: statement
class: text-xl
---

## **D√©coupler** : Core vs Infrastructure

<style>
  strong {
    color: #2B90B6;
  }
</style>

<!--
Quand ? J'ai un appel db / infra en plein milieu de mon code

  code infra = d√©pend de syst√®me externe, besoin d'un environnement pour s'executer (ex:db, I/O System(logs))
  code core (domaine) = logique pure, depend de rien

  ex: dans notre exemple, console.log et math.random
-->

---
name: Refactorer code legacy | Subclass & Override
transition: slide-left
layout: default
class: 
---

# Subclass & Override

> Quand ? le code existant <i>m√©tier</i> (non test√©) a des d√©pendances, emp√™chant d'√©crire des tests (logs, appels BDD)

<br>

> Solution: extraire le code d'<i>infrastructure</i> (logs, appels BDD) dans des m√©thodes d√©di√©es.

<br>

````md magic-move {lines: true}
```ts {*|1,9,10}
// Before Subclass & Override
public boolean add(String playerName) {

    players.add(playerName);
    places[howManyPlayers()] = 0;
    purses[howManyPlayers()] = 0;
    inPenaltyBox[howManyPlayers()] = false;

    System.out.println(playerName + " was added");
    System.out.println("They are player number " + players.size());

    return true;
  }

```
```ts {1,9-10,14-17}
// 5. On expose log() en protected pour les tests
public boolean add(String playerName) {

    players.add(playerName);
    places[howManyPlayers()] = 0;
    purses[howManyPlayers()] = 0;
    inPenaltyBox[howManyPlayers()] = false;

    log(playerName + " was added");
    log("They are player number " + players.size());

    return true;
  }

  protected void log(String message) {
    System.out.println(message);
  }
```
```ts {*|3-5}
// 6. Subclass Game pour les tests
class TestableGame extends Game {
  protected log(message: string): void {
    /* Override: doing nothing.. */
  }
}
```
````

<span v-click>

<br>

>Seam : endroit o√π on peut rajouter un morceau de code sans modifier le code existant
<!-- => Casser les d√©pendances ! -->
<!-- va nous => modifier le comportement du code dans les tests -> pouvoir tester le reste du code -->

</span>

<!-- 
  Subclass & Override: aide √† d√©tecter les morceaux d'infrastructure afin de pouvoir √©crire les tests manquants

  > Avantage de cette technique ? Si on change de strat√©gie de log, on ne change pas les tests
  -> tests d√©coupl√©s de la strat√©gie de log :D
  Si vous faites l'inverse, les tests vont "solidifier" les choix d'implem. -> besoin de tout changer apr√®s.
-->

---
name: Refactorer code legacy | Move Function to Delegate
transition: slide-left
---

# Move Function to Delegate

> Quand ? Apr√®s Subclass & Override. Am√©liorer le design du code √† partir des tests.

<!-- TODO [opt]: si tu as le temps, coordoner le shiki magic move between left(Game class) and right (interface/implem) -->

````md magic-move {lines: true}
```ts {*|14-21}
class Game {
  public boolean add(String playerName) {

    players.add(playerName);
    places[howManyPlayers()] = 0;
    purses[howManyPlayers()] = 0;
    inPenaltyBox[howManyPlayers()] = false;

    log(playerName + " was added");
    log("They are player number " + players.size());

    return true;
  }

  protected void log(String message) {
    System.out.println(message);
  }

  class TestableGame extends Game {
    protected log(String message): void {
      /* Override: doing nothing.. */
    }
  }
}
```
```ts {*}
// 1. Cr√©er une interface qu'on aimerait utiliser: Logger
interface Logger {
  void log(String message);
}
```
```ts {*}
// 2. Cr√©er une interface qu'on aimerait utiliser: Logger
interface Logger {
  void log(String message);
}

class ConsoleLogger implements Logger {
  void log(String message) {

  }
}
```
```ts {4|17-19}
// 3. Move Method (ou Move Function) refactoring
class Game {
  public boolean add(String playerName) {
    private Logger logger = new ConsoleLogger();

    players.add(playerName);
    places[howManyPlayers()] = 0;
    purses[howManyPlayers()] = 0;
    inPenaltyBox[howManyPlayers()] = false;

    log(playerName + " was added");
    log("They are player number " + players.size());

    return true;
  }

  protected void log(String message) {
    System.out.println(message);
  }

  class TestableGame extends Game {
    protected log(String message): void {
      /* Override: doing nothing.. */
    }
  }
}
```
```ts {6-9}
// 4. Cr√©er une interface qu'on aimerait utiliser: Logger
interface Logger {
  void log(String message);
}

class ConsoleLogger implements Logger {
  void log(String message) {
    System.out.println(message);
  }
}
```
```ts {*}
// 5. Injecter le 'Logger' Delegate dans le constructeur
class Game {
  public boolean add(String playerName) {
    private Logger logger = new ConsoleLogger();

    // code..
```
```ts {*}
// 5. Injecter le 'Logger' Delegate dans le constructeur
class Game {
  public boolean add(String playerName) {
  public Game(Logger logger) {
    logger = new ConsoleLogger();
  }
  // code..
```
```ts {*}
// 4. Cr√©er une interface qu'on aimerait utiliser: Logger
interface Logger {
  void log(String message);
}

class ConsoleLogger implements Logger {
  void log(String message) {
    System.out.println(message);
  }
}
```
```ts {1,12-16}
// 5. Cr√©er une impl√©mentation d√©di√©e √† nos tests pour Logger
interface Logger {
  void log(String message);
}

class ConsoleLogger implements Logger {
  void log(String message) {
    System.out.println(message);
  }
}

// Pour les tests
class NoopLogger implements Logger {
  void log(String message) { /* NoOp = ne fait rien */ }
}
```
```ts {*}
class TestableGame extends Game {
  protected log(String message): void {
    /* Override: doing nothing.. */
  }
}
```
```ts {*}
class TestableGame extends Game {
  public TestableGame() {
    super(new NoopLogger()); // Laisse l'instance de logger g√©rer le comportement
  }
}
```
````

<!--
  Etape 3. Si on utilise l'inversion de d√©pendance avec Spring -> directement injecter dans le constructeur
-->

---
name: TMP conseils refacto dans codebase legacy
transition: slide-left
---

# Refactorer dans du code legacy

A retenir

<h3 v-click>Strat√©gie non pr√©dictive</h3> <!-- complexit√© masqu√©e (ex et tu vas le d√©couvrir.. comment ?) -->
  <ul>
    <li v-click>Fail-fast</li>
    <li v-click>Scratch refactoring et exploratoire</li>
    <li v-click>Test-first</li>    
    <li v-click>M√©thode Mikado</li>
    <!--
      strat√©gie de refacto
      on part sur une strat avec un but,
      on continue jusqu'√† ou on perd le controle
      quand √ßa pete, on revient en arri√®re,
      on change de direction (.. ex: on peut pas faire X -> tests approvals)
    -->
    <li v-click>Over-committing (minuteur: N minutes) ou git add -p</li> <!-- But: capable de travailler rapidement et de fa√ßon s√©curitaire sur n'importe quel code -->
  </ul>
  <br>
<h3 v-click>Besoin d'un filet de s√©curit√© efficace</h3>
  <ul>
    <li v-click>Approval testing</li> <!-- car si y'a pas de test -> on peut rien faire -->
    <!--
      üì∏ G√©n√®re un texte que tu peux capturer
      ‚úÖ Utilise la couverture de tests pour trouver toutes les combinaisons √† tester
      üëΩ Introduit des mutations pour v√©rifier la qualit√© de test tests
    -->
    <li v-click>Mutation testing</li> <!-- v√©rifier la pertinence des tests -->
  </ul>
  <!--
  <h3>Reduire la charge cognitive (on se perd, on se rappelle plus du code apr√®s N time, ...)</h3>
  <ul>
  <li>clean code</li>
  <li>typage</li>
  </ul>
  -->

<style>
h3 {
  color: #2B90B6;
  font-size: 18pt;
}
h3 div {
  padding: 8px;
}
ul {
  padding-left: 20pt;
}
</style>

<!-- notes -->

---
transition: slide-up
layout: cover
background: https://images.unsplash.com/photo-1572883454114-1cf0031ede2a?q=80&w=687&auto=format&fit=crop&ixlib=rb-4.1.0&ixid=M3wxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8fA%3D%3D
---

## Conclusion

<div class="absolute bottom-10 right-60 w-50 flex flex-row items-center">
````md magic-move {lines:false}
```ts {*}
  doStuff()
```
```ts {*}
  handleData()
```
```ts {*}
  processConference()
```
```ts {*}
  attendTechConference()
```
```ts {*}
  attendSunnyTechToLearn()
```
```ts {*}
  attendSunnyTech2025ToStayUpdatedOnTech()
```
```ts {*}
  enjoySunnyTechMontpellier2025ForArchitectureAndDevTrends()
```
````
</div>

<style>
h2 {
  font-size: 28pt;
  opacity: 0.8
}
</style>

---
transition: slide-up
layout: image
image: /slide-quelques-references.png
---

# Quelques r√©f√©rences

<style>
h1 {
  color: #2B90B6;
}
</style>

---
layout: image
image: /slide-outro.png
---

---
transition: slide-left
---

<!-- Slide noire de transition -->
